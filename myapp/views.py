from django.shortcuts import render
from datetime import datetime
import pytz  # –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —á–∞—Å–æ–≤–∏–º–∏ –ø–æ—è—Å–∞–º–∏
import random

# –í–∏–ø–∞–¥–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
random_responses = [
    # –ü—Ä–∏–∫–∞–∑–∫–∏
    "–ù–µ —Ç–æ–π –¥—Ä—É–≥, —â–æ –º–µ–¥–æ–º –º–∞–∂–µ, –∞ —Ç–æ–π, —â–æ –ø—Ä–∞–≤–¥—É –∫–∞–∂–µ.",
    "–•—Ç–æ —Ä–∞–Ω–æ –≤—Å—Ç–∞—î ‚Äî —Ç–æ–º—É –ë–æ–≥ –¥–∞—î.",
    "–ë–µ–∑ —Ç—Ä—É–¥–∞ –Ω–µ–º–∞ –ø–ª–æ–¥–∞.",
    "–°–ª–æ–≤–æ ‚Äî –Ω–µ –≥–æ—Ä–æ–±–µ—Ü—å, –≤–∏–ª–µ—Ç–∏—Ç—å ‚Äî –Ω–µ –≤–ø—ñ–π–º–∞—î—à.",
    "–î–µ —Å–∏–ª–∞ –Ω–µ –≤—ñ–∑—å–º–µ, —Ç–∞–º —Ä–æ–∑—É–º –¥–æ–ø–æ–º–æ–∂–µ.",

    # –ñ–∞—Ä—Ç–∏
    "–Ø–∫—â–æ –∂–∏—Ç—Ç—è –¥–∞—î –ª–∏–º–æ–Ω–∏ ‚Äî —à—É–∫–∞–π —Ç–æ–≥–æ, —Ö—Ç–æ –¥–∞—î —Ü—É–∫–æ—Ä üòÑ",
    "–ú–æ–∑–æ–∫ ‚Äî —Ü–µ —è–∫ –ø–∞—Ä–∞—à—É—Ç: –ø—Ä–∞—Ü—é—î –ª–∏—à–µ –∫–æ–ª–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π!",
    "–ù–µ —Ö–≤–∏–ª—é–π—Å—è, —è–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î ‚Äî –º–æ–∂–ª–∏–≤–æ, –≤–æ–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–ø–æ—á–∏–≤–∞—î.",
    "–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî —Ü–µ –º—ñ—Å—Ü–µ, –¥–µ —Ç–∏ —à—É–∫–∞—î—à –æ–¥–Ω–µ, –∞ –∑–Ω–∞—Ö–æ–¥–∏—à –º–µ–º–∏.",
    "–ö—Ä–∞—â–µ –±—É—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–æ–º —ñ –ø–æ–º–∏–ª—è—Ç–∏—Å—å, –Ω—ñ–∂ –ø–µ—Å–∏–º—ñ—Å—Ç–æ–º —ñ –º–∞—Ç–∏ —Ä–∞—Ü—ñ—é üòé",

    # –§—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ —Ü–∏—Ç–∞—Ç–∏
    "–°–≤—ñ—Ç –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–µ —Ç–∏–º–∏, —Ö—Ç–æ —á–µ–∫–∞—î, –∞ —Ç–∏–º–∏, —Ö—Ç–æ –¥—ñ—î.",
    "–ú—É–¥—Ä—ñ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–µ –∑ –≤—ñ–∫–æ–º, –∞ –∑ –¥–æ—Å–≤—ñ–¥–æ–º.",
    "–¢–æ–π, —Ö—Ç–æ –∑–Ω–∞—î –º–µ—Ç—É ‚Äî –∑–Ω–∞–π–¥–µ —à–ª—è—Ö.",
    "–©–∞—Å—Ç—è ‚Äî —Ü–µ –Ω–µ –ø—É–Ω–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è, –∞ —Å–ø–æ—Å—ñ–± –ø–æ–¥–æ—Ä–æ–∂—ñ.",
    "–ù–∞–π–¥–æ–≤—à–∞ –¥–æ—Ä–æ–≥–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –ø–µ—Ä—à–æ–≥–æ –∫—Ä–æ–∫—É."
]

# –Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—É
chat_history = {}

def index_page(request):
    if request.method == "POST":
        user_input = request.POST.get("user_input", "").strip().lower()

        # –ö–∏—ó–≤—Å—å–∫–∏–π —á–∞—Å
        kyiv_tz = pytz.timezone("Europe/Kyiv")
        now_kyiv = datetime.now(kyiv_tz)

        if user_input == "–¥–∞—Ç–∞":
            response = now_kyiv.strftime("%d.%m.%Y")
        elif user_input == "—á–∞—Å":
            response = now_kyiv.strftime("%H:%M:%S")
        else:
            response = random.choice(random_responses)

        index = len(chat_history)
        chat_history[index] = {
            "user": user_input,
            "bot": response
        }

    context = {
        "chat_history": chat_history.values()
    }
    return render(request, "myapp/index.html", context)